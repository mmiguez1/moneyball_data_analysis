<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>c3294d5fdf764cea8193a8a196bb5731</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="tutorial-of-moneyball-data-analysis" class="cell markdown">
<h1>Tutorial of Moneyball Data Analysis</h1>
</section>
<section id="in-this-tutorial-i-provide-a-walk-through-of-how-i-analyze-how-efficient-baseball-teams-have-been-historically-spending-money-and-getting-wins-in-return-in-the-case-of-moneyball-one-would-expect-that-oakland-was-not-much-more-efficient-than-other-teams-in-their-spending-before-2000-were-much-more-efficient-between-2000-and-2005-and-by-then-other-teams-may-have-caught-up-my-goal-in-this-project-is-to-see-how-this-is-reflected-in-data-i-wrangle-transform-and-analyze-data-from-lahmans-baseball-database-which-contains-information-on-baseball-teams-players-and-seasons-curated-by-sean-lahman-specifically-i-look-at-lahmans-2014-data-using-the-python-sqlite-and-pandas-packages-to-access-the-data-and-load-it-into-a-pandas-dataframe" class="cell markdown">
<h3>In this tutorial, I provide a walk-through of how I analyze how efficient baseball teams have been historically spending money and getting wins in return. In the case of Moneyball, one would expect that Oakland was not much more efficient than other teams in their spending before 2000, were much more efficient between 2000 and 2005, and by then other teams may have caught up. My goal in this project is to see how this is reflected in data. I wrangle, transform, and analyze data from <a href="http://www.seanlahman.com/baseball-archive/statistics/">Lahman's Baseball Database</a> which contains information on baseball teams, players and seasons curated by Sean Lahman. Specifically, I look at <a href="https://github.com/jknecht/baseball-archive-sqlite/blob/master/lahman2014.sqlite">Lahman's 2014 data</a> using the Python sqlite and pandas packages to access the data and load it into a pandas dataframe.</h3>
</section>
<div class="cell code">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
</div>
<section id="part-1-wrangling" class="cell markdown">
<h2><u>Part 1: Wrangling</u></h2>
</section>
<div class="cell markdown">
<p>First, I use sqlite to connect to the Lahman 2014 database found on <a href="https://www.seanlahman.com/baseball-archive/statistics/">SeanLahman.com</a>.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sqlite_file <span class="op">=</span> <span class="st">&#39;lahman2014.sqlite&#39;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(sqlite_file)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Next, I query the data to compute a relation containing the total payroll and winning percentage (number of wins / number of games * 100) for each team. I also include columns for League ID, Franchise ID, Division ID, Rank, Wins, and Games to use later for my exploratory analysis.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>salary_query <span class="op">=</span> <span class="st">&quot;SELECT yearID, teamID, sum(salary) as total_payroll FROM Salaries GROUP BY yearID, teamID&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>win_percent_query <span class="op">=</span> <span class="st">&quot;SELECT  yearID, teamID, lgID, divID, rank, W,G, (((W*1.0)/G)*100) as win_percentage \</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">                    FROM Teams GROUP BY yearID, teamID&quot;</span> </span></code></pre></div>
</div>
<div class="cell markdown">
<p>I then load the two sqlite queries for salary and win percentage as two pandas dataframes and merge them into one dataframe.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data as two pandas dataframes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>team_salaries <span class="op">=</span> pd.read_sql(salary_query, conn)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>team_win_percent <span class="op">=</span> pd.read_sql(win_percent_query, conn)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>The salary data contains total payroll for teams from 1985 up to 2014, and the win percentage data contains win percentages for each team from 1871 to 2014. Thus, there is definitely missing data between 1871 and 1985. To account for the missing data from this time discrepancy and any additional missing data, I use an inner join, which is the result of the intersection of the two tables. To merge the data from each team and year, I joined both left and right dataframes on yearID and teamID.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge salary and win percentage dataframes as one</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>team_win_salaries <span class="op">=</span> team_salaries.merge(team_win_percent, how <span class="op">=</span><span class="st">&quot;inner&quot;</span>, left_on<span class="op">=</span>[<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;teamID&quot;</span>],right_on<span class="op">=</span>[<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;teamID&quot;</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute results of one team over the time range </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>one_team <span class="op">=</span> team_win_salaries[team_win_salaries[<span class="st">&quot;teamID&quot;</span>] <span class="op">==</span> <span class="st">&quot;BAL&quot;</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display head of the resulting dataframe &amp; results of one team over the time range</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>display(team_win_salaries.head())</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>display(one_team)</span></code></pre></div>
<div class="output display_data">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yearID</th>
      <th>teamID</th>
      <th>total_payroll</th>
      <th>lgID</th>
      <th>divID</th>
      <th>Rank</th>
      <th>W</th>
      <th>G</th>
      <th>win_percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1985</td>
      <td>ATL</td>
      <td>14807000.0</td>
      <td>NL</td>
      <td>W</td>
      <td>5</td>
      <td>66</td>
      <td>162</td>
      <td>40.740741</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1985</td>
      <td>BAL</td>
      <td>11560712.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>83</td>
      <td>161</td>
      <td>51.552795</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1985</td>
      <td>BOS</td>
      <td>10897560.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>81</td>
      <td>163</td>
      <td>49.693252</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1985</td>
      <td>CAL</td>
      <td>14427894.0</td>
      <td>AL</td>
      <td>W</td>
      <td>2</td>
      <td>90</td>
      <td>162</td>
      <td>55.555556</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1985</td>
      <td>CHA</td>
      <td>9846178.0</td>
      <td>AL</td>
      <td>W</td>
      <td>3</td>
      <td>85</td>
      <td>163</td>
      <td>52.147239</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yearID</th>
      <th>teamID</th>
      <th>total_payroll</th>
      <th>lgID</th>
      <th>divID</th>
      <th>Rank</th>
      <th>W</th>
      <th>G</th>
      <th>win_percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1985</td>
      <td>BAL</td>
      <td>11560712.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>83</td>
      <td>161</td>
      <td>51.552795</td>
    </tr>
    <tr>
      <th>27</th>
      <td>1986</td>
      <td>BAL</td>
      <td>13001258.0</td>
      <td>AL</td>
      <td>E</td>
      <td>7</td>
      <td>73</td>
      <td>162</td>
      <td>45.061728</td>
    </tr>
    <tr>
      <th>53</th>
      <td>1987</td>
      <td>BAL</td>
      <td>13900273.0</td>
      <td>AL</td>
      <td>E</td>
      <td>6</td>
      <td>67</td>
      <td>162</td>
      <td>41.358025</td>
    </tr>
    <tr>
      <th>79</th>
      <td>1988</td>
      <td>BAL</td>
      <td>13532075.0</td>
      <td>AL</td>
      <td>E</td>
      <td>7</td>
      <td>54</td>
      <td>161</td>
      <td>33.540373</td>
    </tr>
    <tr>
      <th>105</th>
      <td>1989</td>
      <td>BAL</td>
      <td>8275167.0</td>
      <td>AL</td>
      <td>E</td>
      <td>2</td>
      <td>87</td>
      <td>162</td>
      <td>53.703704</td>
    </tr>
    <tr>
      <th>131</th>
      <td>1990</td>
      <td>BAL</td>
      <td>9680084.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>76</td>
      <td>161</td>
      <td>47.204969</td>
    </tr>
    <tr>
      <th>157</th>
      <td>1991</td>
      <td>BAL</td>
      <td>17519000.0</td>
      <td>AL</td>
      <td>E</td>
      <td>6</td>
      <td>67</td>
      <td>162</td>
      <td>41.358025</td>
    </tr>
    <tr>
      <th>183</th>
      <td>1992</td>
      <td>BAL</td>
      <td>23780667.0</td>
      <td>AL</td>
      <td>E</td>
      <td>3</td>
      <td>89</td>
      <td>162</td>
      <td>54.938272</td>
    </tr>
    <tr>
      <th>209</th>
      <td>1993</td>
      <td>BAL</td>
      <td>29096500.0</td>
      <td>AL</td>
      <td>E</td>
      <td>3</td>
      <td>85</td>
      <td>162</td>
      <td>52.469136</td>
    </tr>
    <tr>
      <th>237</th>
      <td>1994</td>
      <td>BAL</td>
      <td>38849769.0</td>
      <td>AL</td>
      <td>E</td>
      <td>2</td>
      <td>63</td>
      <td>112</td>
      <td>56.250000</td>
    </tr>
    <tr>
      <th>265</th>
      <td>1995</td>
      <td>BAL</td>
      <td>43942521.0</td>
      <td>AL</td>
      <td>E</td>
      <td>3</td>
      <td>71</td>
      <td>144</td>
      <td>49.305556</td>
    </tr>
    <tr>
      <th>293</th>
      <td>1996</td>
      <td>BAL</td>
      <td>54490315.0</td>
      <td>AL</td>
      <td>E</td>
      <td>2</td>
      <td>88</td>
      <td>163</td>
      <td>53.987730</td>
    </tr>
    <tr>
      <th>322</th>
      <td>1997</td>
      <td>BAL</td>
      <td>58516400.0</td>
      <td>AL</td>
      <td>E</td>
      <td>1</td>
      <td>98</td>
      <td>162</td>
      <td>60.493827</td>
    </tr>
    <tr>
      <th>351</th>
      <td>1998</td>
      <td>BAL</td>
      <td>72355634.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>79</td>
      <td>162</td>
      <td>48.765432</td>
    </tr>
    <tr>
      <th>381</th>
      <td>1999</td>
      <td>BAL</td>
      <td>80605863.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>78</td>
      <td>162</td>
      <td>48.148148</td>
    </tr>
    <tr>
      <th>411</th>
      <td>2000</td>
      <td>BAL</td>
      <td>81447435.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>74</td>
      <td>162</td>
      <td>45.679012</td>
    </tr>
    <tr>
      <th>441</th>
      <td>2001</td>
      <td>BAL</td>
      <td>67599540.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>63</td>
      <td>162</td>
      <td>38.888889</td>
    </tr>
    <tr>
      <th>471</th>
      <td>2002</td>
      <td>BAL</td>
      <td>60493487.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>67</td>
      <td>162</td>
      <td>41.358025</td>
    </tr>
    <tr>
      <th>501</th>
      <td>2003</td>
      <td>BAL</td>
      <td>73877500.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>71</td>
      <td>163</td>
      <td>43.558282</td>
    </tr>
    <tr>
      <th>531</th>
      <td>2004</td>
      <td>BAL</td>
      <td>51623333.0</td>
      <td>AL</td>
      <td>E</td>
      <td>3</td>
      <td>78</td>
      <td>162</td>
      <td>48.148148</td>
    </tr>
    <tr>
      <th>560</th>
      <td>2005</td>
      <td>BAL</td>
      <td>73914333.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>74</td>
      <td>162</td>
      <td>45.679012</td>
    </tr>
    <tr>
      <th>590</th>
      <td>2006</td>
      <td>BAL</td>
      <td>72585582.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>70</td>
      <td>162</td>
      <td>43.209877</td>
    </tr>
    <tr>
      <th>620</th>
      <td>2007</td>
      <td>BAL</td>
      <td>93174808.0</td>
      <td>AL</td>
      <td>E</td>
      <td>4</td>
      <td>69</td>
      <td>162</td>
      <td>42.592593</td>
    </tr>
    <tr>
      <th>650</th>
      <td>2008</td>
      <td>BAL</td>
      <td>67196246.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>68</td>
      <td>161</td>
      <td>42.236025</td>
    </tr>
    <tr>
      <th>680</th>
      <td>2009</td>
      <td>BAL</td>
      <td>67101666.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>64</td>
      <td>162</td>
      <td>39.506173</td>
    </tr>
    <tr>
      <th>710</th>
      <td>2010</td>
      <td>BAL</td>
      <td>81612500.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>66</td>
      <td>162</td>
      <td>40.740741</td>
    </tr>
    <tr>
      <th>740</th>
      <td>2011</td>
      <td>BAL</td>
      <td>85304038.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>69</td>
      <td>162</td>
      <td>42.592593</td>
    </tr>
    <tr>
      <th>770</th>
      <td>2012</td>
      <td>BAL</td>
      <td>77353999.0</td>
      <td>AL</td>
      <td>E</td>
      <td>2</td>
      <td>93</td>
      <td>162</td>
      <td>57.407407</td>
    </tr>
    <tr>
      <th>800</th>
      <td>2013</td>
      <td>BAL</td>
      <td>84393333.0</td>
      <td>AL</td>
      <td>E</td>
      <td>3</td>
      <td>85</td>
      <td>162</td>
      <td>52.469136</td>
    </tr>
    <tr>
      <th>830</th>
      <td>2014</td>
      <td>BAL</td>
      <td>103416000.0</td>
      <td>AL</td>
      <td>E</td>
      <td>1</td>
      <td>96</td>
      <td>162</td>
      <td>59.259259</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="part-2-exploratory-data-analysis" class="cell markdown">
<h2><u>Part 2: Exploratory Data Analysis</u></h2>
</section>
<section id="payroll-distribution" class="cell markdown">
<h2>Payroll Distribution</h2>
</section>
<div class="cell markdown">
<p>First, I plot a boxplot displaying the distribution of payrolls across teams conditioned on time (from 1990-2014). The below boxplot shows the distribution of payrolls across teams. Based on the boxplot, we can see that the spread of the highest team payroll increases over time, reaching an all time high in 2014, and the average total payroll for each team increases over time.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by data from years 1990-2014</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>payroll_1990 <span class="op">=</span> team_win_salaries[team_win_salaries[<span class="st">&#39;yearID&#39;</span>] <span class="op">&gt;=</span> <span class="dv">1990</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot boxplot of total payroll data for teams from 1990-2014</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.boxplot(data <span class="op">=</span> payroll_1990, x<span class="op">=</span><span class="st">&#39;yearID&#39;</span>,y<span class="op">=</span>(<span class="st">&#39;total_payroll&#39;</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate years by 90 degrees</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> ax.get_xticklabels():</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    item.set_rotation(<span class="dv">90</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Total Payroll&#39;</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of payrolls across teams conditioned on time (from 1990-2014)&#39;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/abcf089c724ac8ae2bc0ee0dcd6e16c603c742d1.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Second, I plot a scatter plot that shows winning percentage as a function of total payroll. The below scatter plot shows the winning percentage as a function of total payroll. Based on the scattter plot, we can see a general trajectory of points going slightly up to the right. This indicates that there is a positive correlation between winning percentage and total payroll.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> payroll_1990.plot.scatter(x<span class="op">=</span><span class="st">&#39;total_payroll&#39;</span>,y<span class="op">=</span><span class="st">&#39;win_percentage&#39;</span>,c<span class="op">=</span><span class="st">&#39;plum&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Total Payroll&#39;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Winning Percentage&#39;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Winning Percentage as a Function of Total Payroll&#39;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/6e2c1d07f94e339c649fd4cbe553335070105298.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Next, I plot two bar graphs.</p>
</div>
<div class="cell markdown">
<p>The first graph plots the average total payroll for each year from 1990-2014. From this graph, we can see that the average total payroll steadily increases from 1990 to 2014.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot bar graph of average total payrolls</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>payroll_avg <span class="op">=</span> payroll_1990.groupby([<span class="st">&quot;yearID&quot;</span>])[<span class="st">&quot;total_payroll&quot;</span>].mean()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> payroll_avg.plot.bar(rot<span class="op">=</span><span class="dv">90</span>, color<span class="op">=</span><span class="st">&#39;yellowgreen&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Average Total Payroll From 1990-2014&#39;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Average Payroll&#39;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/e5805a6a3143577fef2f6a727f0b83cdaca1c98a.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The second bar graph plots the range (maximum payroll - minimum payroll) of payrolls for each year from 1990-2014. From this graph, we can see that the range of payrolls increases from 1990 to 2014.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate range by subtracting max and min payroll values</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>payroll_min_max <span class="op">=</span> payroll_1990.groupby(<span class="st">&#39;yearID&#39;</span>)[<span class="st">&#39;total_payroll&#39;</span>].agg([<span class="bu">min</span>,<span class="bu">max</span>])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>payroll_min_max[<span class="st">&#39;difference&#39;</span>] <span class="op">=</span> payroll_min_max[<span class="st">&#39;max&#39;</span>] <span class="op">-</span> payroll_min_max[<span class="st">&#39;min&#39;</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot bar graph of range of payrolls</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>payroll_min_max.difference.plot.bar(stacked<span class="op">=</span><span class="va">True</span>, rot<span class="op">=</span><span class="dv">90</span>, color<span class="op">=</span>([<span class="st">&#39;skyblue&#39;</span>]))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Range of Payrolls From 1990-2014&#39;</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/d0454041c0bf408e12abdc610fa6c9ec8931e5a4.png" /></p>
</div>
</div>
<section id="correlation-between-payroll-and-winning-percentage" class="cell markdown">
<h2>Correlation Between Payroll and Winning Percentage</h2>
</section>
<div class="cell markdown">
<p>First, I discretize year into five time periods (1990-1995, 1995-2000, 2000-2005, 2005-2010, 2010-2014) using pandas .cut function.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discretize year into five time periods</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>periods <span class="op">=</span> [<span class="st">&#39;period_1&#39;</span>,<span class="st">&#39;period_2&#39;</span>,<span class="st">&#39;period_3&#39;</span>,<span class="st">&#39;period_4&#39;</span>,<span class="st">&#39;period_5&#39;</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>team_win_salaries[<span class="st">&#39;time_period&#39;</span>] <span class="op">=</span> pd.cut(team_win_salaries[<span class="st">&#39;yearID&#39;</span>],[<span class="dv">1990</span>,<span class="dv">1995</span>,<span class="dv">2000</span>,<span class="dv">2005</span>,<span class="dv">2010</span>,<span class="dv">2015</span>] <span class="op">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                          ,right<span class="op">=</span><span class="va">False</span>, labels<span class="op">=</span>periods)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>I then make a set of scatter plot showing average winning percentage (y-axis) vs. average payroll (x-axis) for each of the five time periods. Each point on the graph represents a specific team's payroll. I add a regression line to better visualize the correlation.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform payroll data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>payroll_df <span class="op">=</span> team_win_salaries[team_win_salaries[<span class="st">&#39;yearID&#39;</span>] <span class="op">&gt;=</span> <span class="dv">1990</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>payroll_df <span class="op">=</span> payroll_df.set_index(<span class="st">&#39;yearID&#39;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Average Winning Percentage (y-axis) vs. Average Payroll (x-axis) for each of the Five Time Periods&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> period <span class="kw">in</span> periods:</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> payroll_df[payroll_df[<span class="st">&#39;time_period&#39;</span>] <span class="op">==</span> period].groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;win_percentage&#39;</span>].mean()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> per_winning.dropna()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span>  payroll_df[payroll_df[<span class="st">&#39;time_period&#39;</span>] <span class="op">==</span> period].groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;total_payroll&#39;</span>].mean()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span> per_payroll.dropna()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make scatter plot</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    plt.scatter(per_payroll, per_winning, color<span class="op">=</span><span class="st">&#39;lightcoral&#39;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    plt.title(period)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot Regression Line</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    m, b <span class="op">=</span> np.polyfit(per_payroll.values, per_winning.values, deg <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    plt.plot(per_payroll.values, m <span class="op">*</span> per_payroll.values <span class="op">+</span> b, color <span class="op">=</span> <span class="st">&#39;forestgreen&#39;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annotate team names to scatter plot values </span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span> per_payroll.reset_index()</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> per_winning.reset_index()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, team <span class="kw">in</span> <span class="bu">enumerate</span>(per_payroll.teamID):</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        plt.annotate(team, (per_payroll.values[i][<span class="dv">2</span>], per_winning.values[i][<span class="dv">2</span>]),size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Average Payroll&quot;</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;Average Winning Percentage&quot;</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Average Winning Percentage (y-axis) vs. Average Payroll (x-axis) for each of the Five Time Periods
</code></pre>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/3498b01fdf6cfda7e73cec1978ff94fe02d5fea2.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/4933966add51519a9d9f9e2f18fc3ff702b50381.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/2432f0456f3a21c44afe6802dd006047264a3b44.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/693d7a27f07b32cca769fa457b80c773b711be16.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/f21576256730a2b0db1f408cb62902056868ca88.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The above scatter plots show that there is a positive correlation between average winning percentage and average payroll. On average, most teams with higher payrolls appear to have a higher winning percentage. ATL and NYA appear to be particularly good at paying for wins. Apart from period 1, the Oakland A's appear to be at the lower end of the payroll distribution. During period 3 (2000-2005), the Oakland A's have the highest winning percentage despite its payroll being significantly less than the majority of teams. In periods 4 and 5, the Oakland A's continue to have low payrolls and one of the highest winning percentages. This shows that its efficiency in spending and getting wins is high during that time, allowing the team to beat high-paid teams.</p>
</div>
<section id="part-3-data-transformations" class="cell markdown">
<h2><u>Part 3: Data Transformations</u></h2>
</section>
<section id="standardizing-across-years" class="cell markdown">
<h2>Standardizing Across Years</h2>
</section>
<div class="cell markdown">
<p>Here, I create a new variable that standardizes payroll conditioned on year. For this, I compute the Z-score of the variables using the value of the payroll, the average payroll, and standard deviation of the payroll.</p>
</div>
<div class="cell code" data-scrolled="true">
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average &amp; standard deviation of payrolls according to year</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>payroll_avg <span class="op">=</span> payroll_avg.reset_index()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>payroll_std <span class="op">=</span> payroll_df.groupby([<span class="st">&quot;yearID&quot;</span>])[<span class="st">&quot;total_payroll&quot;</span>].std()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>payroll_std <span class="op">=</span> payroll_std.reset_index()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new dataframe columns for average payroll and standard deviation payroll</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>payroll_df[<span class="st">&#39;average_payroll&#39;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>payroll_df[<span class="st">&#39;standard_deviation_payroll&#39;</span>] <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through payrolls</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> payroll_df.iterrows():</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute average and standard deviation for each row</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    payroll <span class="op">=</span> row[<span class="dv">1</span>]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    avg_payroll <span class="op">=</span> payroll_avg[payroll_avg[<span class="st">&#39;yearID&#39;</span>] <span class="op">==</span> index][<span class="st">&#39;total_payroll&#39;</span>].tolist()[<span class="dv">0</span>]</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    std_payroll <span class="op">=</span> payroll_std[payroll_std[<span class="st">&#39;yearID&#39;</span>] <span class="op">==</span> index][<span class="st">&#39;total_payroll&#39;</span>].tolist()[<span class="dv">0</span>]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append computed values to payroll dataframe</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    payroll_df.at[index, <span class="st">&#39;average_payroll&#39;</span>] <span class="op">=</span> avg_payroll</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    payroll_df.at[index, <span class="st">&#39;standard_deviation_payroll&#39;</span>] <span class="op">=</span> std_payroll</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standardized payroll</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>payroll_df[<span class="st">&#39;standardized_payroll&#39;</span>] <span class="op">=</span> (payroll_df[<span class="st">&#39;total_payroll&#39;</span>] <span class="op">-</span> payroll_df[<span class="st">&#39;average_payroll&#39;</span>]) <span class="op">/</span>  payroll_df[<span class="st">&#39;standard_deviation_payroll&#39;</span>]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>display(payroll_df.head())</span></code></pre></div>
<div class="output display_data">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>teamID</th>
      <th>total_payroll</th>
      <th>lgID</th>
      <th>divID</th>
      <th>Rank</th>
      <th>W</th>
      <th>G</th>
      <th>win_percentage</th>
      <th>time_period</th>
      <th>average_payroll</th>
      <th>standard_deviation_payroll</th>
      <th>standardized_payroll</th>
    </tr>
    <tr>
      <th>yearID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1990</th>
      <td>ATL</td>
      <td>14555501.0</td>
      <td>NL</td>
      <td>W</td>
      <td>6</td>
      <td>65</td>
      <td>162</td>
      <td>40.123457</td>
      <td>period_1</td>
      <td>17072353.576923</td>
      <td>3771834.264904</td>
      <td>-0.667275</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>BAL</td>
      <td>9680084.0</td>
      <td>AL</td>
      <td>E</td>
      <td>5</td>
      <td>76</td>
      <td>161</td>
      <td>47.204969</td>
      <td>period_1</td>
      <td>17072353.576923</td>
      <td>3771834.264904</td>
      <td>-1.959861</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>BOS</td>
      <td>20558333.0</td>
      <td>AL</td>
      <td>E</td>
      <td>1</td>
      <td>88</td>
      <td>162</td>
      <td>54.320988</td>
      <td>period_1</td>
      <td>17072353.576923</td>
      <td>3771834.264904</td>
      <td>0.924213</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>CAL</td>
      <td>21720000.0</td>
      <td>AL</td>
      <td>W</td>
      <td>4</td>
      <td>80</td>
      <td>162</td>
      <td>49.382716</td>
      <td>period_1</td>
      <td>17072353.576923</td>
      <td>3771834.264904</td>
      <td>1.232198</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>CHA</td>
      <td>9491500.0</td>
      <td>AL</td>
      <td>W</td>
      <td>2</td>
      <td>94</td>
      <td>162</td>
      <td>58.024691</td>
      <td>period_1</td>
      <td>17072353.576923</td>
      <td>3771834.264904</td>
      <td>-2.009859</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>I repeat the scatter same plots as shown above, but use the standardized payroll variable instead of the total payroll variable. This scatter plot shows the average winning percentage (y-axis) vs. average standardized payroll (x-axis) for each of the five time periods. Each point on the graph represents a specific team's standardized payroll. I add a regression line to better visualize the correlation.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Average Winning Percentage (y-axis) vs. Average Standardized Payroll (x-axis) for each of the Five Time Periods&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> period <span class="kw">in</span> periods:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> payroll_df[payroll_df[<span class="st">&#39;time_period&#39;</span>] <span class="op">==</span> period].groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;win_percentage&#39;</span>].mean()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> per_winning.dropna()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span>  payroll_df[payroll_df[<span class="st">&#39;time_period&#39;</span>] <span class="op">==</span> period].groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;standardized_payroll&#39;</span>].mean()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span> per_payroll.dropna()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make scatter plot</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    plt.scatter(per_payroll, per_winning, color<span class="op">=</span><span class="st">&#39;mediumpurple&#39;</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    plt.title(period)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot Regression Line</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    m, b <span class="op">=</span> np.polyfit(per_payroll.values, per_winning.values, deg <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    plt.plot(per_payroll.values, m <span class="op">*</span> per_payroll.values <span class="op">+</span> b, color<span class="op">=</span><span class="st">&#39;turquoise&#39;</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annotate team names to scatter plot values </span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    per_payroll <span class="op">=</span> per_payroll.reset_index()</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    per_winning <span class="op">=</span> per_winning.reset_index()</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, team <span class="kw">in</span> <span class="bu">enumerate</span>(per_payroll.teamID):</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        plt.annotate(team, (per_payroll.values[i][<span class="dv">2</span>], per_winning.values[i][<span class="dv">2</span>]),size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Average Standardized Payroll&quot;</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;Average Winning Percentage&quot;</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Average Winning Percentage (y-axis) vs. Average Standardized Payroll (x-axis) for each of the Five Time Periods
</code></pre>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/733faead6c60086db39e4037417d95b4fae7ac0b.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/408a84e6d0a4f005fbda342ac06fd566ff8db46a.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/7e63974889532b7d7bd62f3e5ef37cdb20d62327.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/d3a9e31a458120a6c09a113979c0116e4a19b99c.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/c501f7b0de3b5d849493986159553b54923e0961.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The points on the scatter plots of the average total payroll are more difficult to compare than the scatter plots of the average standardized payroll. This is the case because each time period plot has a different payroll scale. In the scatter plots of the average standaradized payroll above, the standardized payroll data represents the payroll data from the average total payroll on standard scale. Thus, average payrolls for each period are able to be compared more easily without giving one payroll a greater weight than another. On this standardized scale, it is more apparent that teams with higher payrolls typically have a higher winning percentage. It is also easier to see that Oakland was not much more efficient than other teams in their spending in periods 1 and 2, were much more efficient in period 3, and by period 4, other teams may have caught up.</p>
</div>
<section id="expected-wins" class="cell markdown">
<h2>Expected Wins</h2>
</section>
<div class="cell markdown">
<p>Here, I make a single scatter plot of winning percentage (y-axis) vs. standardized payroll (x-axis) and add a regression line to highlight the relationship.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>per_winning <span class="op">=</span> payroll_df.groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;win_percentage&#39;</span>].mean()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>per_winning <span class="op">=</span> per_winning.dropna()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>per_payroll <span class="op">=</span>  payroll_df.groupby(by<span class="op">=</span>[<span class="st">&quot;time_period&quot;</span>, <span class="st">&quot;teamID&quot;</span>])[<span class="st">&#39;standardized_payroll&#39;</span>].mean()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>per_payroll <span class="op">=</span> per_payroll.dropna()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make scatter plot</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(per_payroll, per_winning, color<span class="op">=</span><span class="st">&#39;darkorange&#39;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Winning Percentage&#39;</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Standardized Payroll&#39;</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Winning Percentage vs. Standardized Payroll&quot;</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Regression Line</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>m, b <span class="op">=</span> np.polyfit(per_payroll.values, per_winning.values, deg <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>plt.plot(per_payroll.values, m <span class="op">*</span> per_payroll.values <span class="op">+</span> b, color<span class="op">=</span><span class="st">&#39;lightseagreen&#39;</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/1b5c518172aa1eadb2c0329e22660967a42d8923.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The regression line gives you expected winning percentage as a function of standardized payroll. Looking at the regression line, it looks like teams that spend roughly the average payroll in a given year will win 50% of their games (i.e. win_pct is 50 when standardized_payroll is 0), and teams increase 5% wins for every 2 standard units of payroll (i.e., win_pct is 55 when standardized_payroll is 2). From these observations, I calculate the expected win percentage for team i in year j.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>payroll_df[<span class="st">&#39;expected_win_pct&#39;</span>] <span class="op">=</span> <span class="dv">50</span> <span class="op">+</span> <span class="fl">2.5</span><span class="op">*</span>payroll_df[<span class="st">&#39;standardized_payroll&#39;</span>]</span></code></pre></div>
</div>
<section id="spending-efficiency" class="cell markdown">
<h2>Spending Efficiency</h2>
</section>
<div class="cell markdown">
<p>I now create a single plot that makes it easier to compare teams efficiency. I create a new measurement unit for each team based on their winning percentage and their expected winning percentage that can be plotted across time summarizing how efficient each team is in their spending.</p>
</div>
<div class="cell markdown">
<p>First, I create a new field to compute each team’s spending efficiency, for team i in year j.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>payroll_df[<span class="st">&#39;efficiency&#39;</span>] <span class="op">=</span> payroll_df[<span class="st">&#39;win_percentage&#39;</span>] <span class="op">-</span> payroll_df[<span class="st">&#39;expected_win_pct&#39;</span>]</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Next, I make a line plot with year on the x-axis and spending efficiency on the y-axis for Oakland, the New York Yankees, Boston, Atlanta and Tampa Bay. Each line represents a specific team's spending efficiency.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe for Oakland, the New York Yankees, Boston, Atlanta and Tampa Bay spending efficiency</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>teams_payroll <span class="op">=</span> payroll_df.loc[(payroll_df[<span class="st">&#39;teamID&#39;</span>] <span class="op">==</span> <span class="st">&#39;OAK&#39;</span>) <span class="op">|</span> (payroll_df[<span class="st">&#39;teamID&#39;</span>] <span class="op">==</span> <span class="st">&#39;NYA&#39;</span>) <span class="op">|</span> (payroll_df[<span class="st">&#39;teamID&#39;</span>] <span class="op">==</span> <span class="st">&#39;BOS&#39;</span>) <span class="op">|</span> <span class="op">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 (payroll_df[<span class="st">&#39;teamID&#39;</span>] <span class="op">==</span> <span class="st">&#39;ATL&#39;</span>) <span class="op">|</span> (payroll_df[<span class="st">&#39;teamID&#39;</span>] <span class="op">==</span> <span class="st">&#39;TBA&#39;</span>)]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>teams_payroll <span class="op">=</span> teams_payroll.reset_index()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>team_efficiency <span class="op">=</span> teams_payroll.pivot(index<span class="op">=</span><span class="st">&#39;yearID&#39;</span>, columns<span class="op">=</span><span class="st">&#39;teamID&#39;</span>, values<span class="op">=</span><span class="st">&#39;efficiency&#39;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot spending efficiency</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>team_efficiency.plot(kind <span class="op">=</span> <span class="st">&#39;line&#39;</span>,title <span class="op">=</span><span class="st">&quot;Spending Efficiency For Oakland, New York Yankees, Boston, Atlanta, and Tampa Bay Over Time&quot;</span>, <span class="op">\</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                     marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, legend<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Year&quot;</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Spending Efficiency&quot;</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_3e772be3e8ce41c5b5e5f3bd9c15e242/db1dd55a24e854c3ad9550f549228e19b48e11d4.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The above line plot with year on the x-axis and spending efficiency on the y-axis for Oakland, the New York Yankees, Boston, Atlanta and Tampa Bay. Each line represents a specific team's spending efficiency. This plot shows that the spending efficiency of teams is variable and changes each year. Compared to the set of plots I looked at in earlier, this plot determines the spending efficiency of teams directly over the course of the time periods. This plot shows that Oakland's spending efficiency was at its highest and higher than that of New York, Boston, Atlanta, and Tampa Bay during the Moneyball period between 2000 and 2005. Additionally, this plot shows that some teams with historically high payrolls still had periods of high spending efficiency, such as NYA between 1995-2000.</p>
</div>
<section id="i-hope-you-enjoyed-reading-this-tutorial-thank-you" class="cell markdown">
<h3>I hope you enjoyed reading this tutorial! Thank you!!</h3>
</section>
</body>
</html>
